<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-adsense-account" content="ca-pub-5275935514649197" />
    <title>Puppy Logger</title>
    <link
      rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='90'%3Eüê∂%3C/text%3E%3C/svg%3E"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .editing {
        padding: 0.5rem;
        border-radius: 0.5rem;
        margin-top: 0.4rem;
      }
      .modal {
        background-color: rgba(0, 0, 0, 0.5);
      }
      .truncate-note {
        max-width: 100%;
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      @keyframes fadeSlideDown {
        from {
          opacity: 0;
          transform: translateY(-4px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-open {
        animation: fadeSlideDown 0.3s cubic-bezier(0.6, -0.28, 0.735, 0.045);
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
    <header class="w-full max-w-sm text-center">
      <h1 class="text-2xl font-bold mb-6">üê∂ Puppy Activity Logger</h1>
    </header>

    <main class="flex-grow w-full max-w-md space-y-6">
      <section aria-labelledby="activity-controls">
        <h2 id="activity-controls" class="sr-only">Log Activities</h2>
        <form
          id="activity-form"
          role="group"
          aria-label="Log puppy activities"
          class="grid grid-cols-2 gap-4 mb-6"
        >
          <button
            type="button"
            onclick="logActivity('üç¥ Feed')"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
          >
            üç¥ Feed
          </button>
          <button
            type="button"
            onclick="logActivity('üõè Nap')"
            class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded"
          >
            üõè Nap
          </button>
          <button
            type="button"
            onclick="logActivity('‚öΩ Play')"
            class="bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded"
          >
            ‚öΩ Play
          </button>
          <button
            type="button"
            onclick="logActivity('üíß Pee')"
            class="bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-2 px-4 rounded"
          >
            üíß Pee
          </button>
          <button
            type="button"
            onclick="logActivity('üí© Poop')"
            class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded col-span-2"
          >
            üí© Poop
          </button>
        </form>
      </section>

      <section
        aria-label="jump-controls"
        class="jump-controls flex justify-between mb-4"
      >
        <form id="top-jump-form" role="group" aria-label="Jump to region">
          <button
            type="button"
            onclick="scrollToBottom()"
            class="px-3 py-1 rounded border"
          >
            Jump to bottom
          </button>
          <button
            type="button"
            onclick="openDatePicker()"
            class="px-3 py-1 rounded border"
          >
            Jump to date
          </button>
          <input
            type="date"
            id="datePicker"
            class="hidden ml-2 border rounded px-2 py-1"
          />
        </form>
      </section>

      <!-- Welcome message (show when list is empty) -->
      <section
        id="welcome-message"
        role="region"
        aria-label="Welcome message"
        class="max-w-md mx-auto bg-white p-6 rounded-lg shadow mb-6"
      >
        <h2 class="text-xl font-bold mb-2">
          Welcome to Puppy Activity Logger!
        </h2>
        <p class="mb-4">
          Puppy Activity Logger is a lightweight, mobile-friendly web app that
          helps you keep track of your puppy‚Äôs daily routine‚Äîno sign-up or
          server needed, and all data stays private on your device.
        </p>

        <h3 class="text-lg font-semibold mb-1">How it works</h3>
        <ol class="list-decimal list-inside mb-4 text-gray-700 space-y-1">
          <li>
            <strong>Log an event:</strong> Tap one of the activity buttons above
            (Feed, Nap, Play, Pee, Poop). Each tap instantly records the current
            time.
          </li>
          <li>
            <strong>View your timeline:</strong> Entries appear below, grouped
            by date and sorted newest-first.
          </li>
          <li>
            <strong>Edit anytime:</strong> Tap the ‚úèÔ∏è icon next to any entry to
            change its start time or activity, add a note or end time, or delete
            it.
          </li>
        </ol>

        <h3 class="text-lg font-semibold mb-1">Getting started</h3>
        <ul class="list-disc list-inside mb-4 text-gray-700 space-y-1">
          <li>Tap <strong>üç¥ Feed</strong> when mealtime arrives.</li>
          <li>Tap <strong>üõè Nap</strong> as your pup drifts off.</li>
          <li>
            Use <strong>‚öΩ Play</strong>, <strong>üíß Pee</strong>, and
            <strong>üí© Poop</strong> for quick logging throughout the day.
          </li>
        </ul>

        <h3 class="text-lg font-semibold mb-1">Core features</h3>
        <ul class="list-disc list-inside mb-4 text-gray-700 space-y-1">
          <li>
            <strong>Instant logging:</strong> One-tap entries with no delays.
          </li>
          <li>
            <strong>Local privacy:</strong> Everything saved in your browser‚Äôs
            local storage‚Äîno data ever leaves your device.
          </li>
          <li>
            <strong>Full editing:</strong> Adjust times, add notes or an end
            time, and delete entries on the fly.
          </li>
          <li>
            <strong>Daily organization:</strong> Automatically groups logs by
            date for easy review.
          </li>
          <li>
            <strong>Responsive design:</strong> Optimized for phones and
            tablets, so you can log on the go.
          </li>
        </ul>

        <p class="text-gray-600">
          Ready to start? Tap a button above to record your puppy‚Äôs first
          activity!
        </p>
      </section>

      <section aria-labelledby="log-list">
        <h2 id="log-list" class="sr-only">Activity Logs</h2>
        <ul id="logList" class="list-none p-0 space-y-6 w-full max-w-md"></ul>
        <button
          type="button"
          onclick="openClearConfirm()"
          class="text-sm text-red-700 hover:underline"
        >
          Clear All Entries
        </button>
      </section>

      <section
        aria-label="bottom-jump-controls"
        class="jump-controls flex justify-between mt-4"
      >
        <form id="bottom-jump-form">
          <button
            type="button"
            onclick="scrollToTop()"
            class="px-3 py-1 rounded border"
          >
            Jump to top
          </button>
          <button
            type="button"
            onclick="openDatePicker()"
            class="px-3 py-1 rounded border"
          >
            Jump to date
          </button>
        </form>
      </section>
    </main>

    <footer class="w-full max-w-md text-center text-xs text-gray-500 mt-8">
      <button
        type="button"
        onclick="openModal()"
        class="text-blue-700 underline"
      >
        Privacy Policy
      </button>
      <p class="mt-2">¬© 2025 Joshua Palmer. All rights reserved.</p>
    </footer>

    <!-- Privacy Policy Modal -->
    <div
      id="modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="privacy-title"
      class="fixed inset-0 hidden items-center justify-center modal z-50"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 max-w-md">
        <h2 id="privacy-title" class="text-xl font-bold mb-4">
          Privacy Policy
        </h2>
        <p class="mb-4 text-sm">
          This site uses local storage to keep your puppy activity logs private
          on your own device.<br />
          We do not collect, store, or transmit any personal data to our servers
          or third parties.<br /><br />
          If ads are displayed, third-party advertisers may use cookies to serve
          ads based on your prior visits.<br /><br />
          As an Amazon Associate, I earn from qualifying purchases.
        </p>
        <button
          type="button"
          onclick="closeModal()"
          class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded"
        >
          Close
        </button>
      </div>
    </div>

    <!-- Clear Confirmation Modal -->
    <div
      id="clearConfirmModal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="confirm-title"
      class="fixed inset-0 hidden items-center justify-center modal z-50"
    >
      <div
        class="bg-white p-6 rounded-lg shadow-lg w-11/12 max-w-md text-center"
      >
        <h2 id="confirm-title" class="text-xl font-bold mb-4">Are you sure?</h2>
        <p class="text-sm mb-6">
          This will delete all your logged puppy activities. This cannot be
          undone.
        </p>
        <div class="flex justify-center space-x-4">
          <button
            type="button"
            onclick="confirmClearLog()"
            class="bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-4 rounded"
          >
            Yes, Clear
          </button>
          <button
            type="button"
            onclick="closeClearConfirm()"
            class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <script>
      let editing = { date: null, id: null, showEndTime: false };
      let lastEditing = { date: null, id: null };
      let showNoteInput = false;
      const activities = [
        { emoji: "üç¥", label: "Feed" },
        { emoji: "üõè", label: "Nap" },
        { emoji: "‚öΩ", label: "Play" },
        { emoji: "üíß", label: "Pee" },
        { emoji: "üí©", label: "Poop" },
      ];

      function logActivity(activity) {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });
        // new: local date
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        const day = String(now.getDate()).padStart(2, "0");
        const today = `${year}-${month}-${day}`;

        const logs = JSON.parse(localStorage.getItem("puppyLogs")) || {};
        if (!logs[today]) logs[today] = [];
        logs[today].unshift({ id: Date.now(), time: timeString, activity });
        localStorage.setItem("puppyLogs", JSON.stringify(logs));
        renderLogs();
      }

      function renderLogs() {
        const isNewEdit =
          editing.date !== lastEditing.date || editing.id !== lastEditing.id;
        const logs = JSON.parse(localStorage.getItem("puppyLogs")) || {};
        const logList = document.getElementById("logList");
        logList.innerHTML = "";
        const dates = Object.keys(logs).sort((a, b) => b.localeCompare(a));

        dates.forEach((date, idx) => {
          const dateItem = document.createElement("li");
          const section = document.createElement("section");
          section.className = "bg-white shadow rounded-lg p-4";
          section.setAttribute("data-date", date);
          section.id = `section-${date}`;

          const title = document.createElement("h3");
          title.className = "text-md font-bold mb-2";
          title.textContent = formatDate(date);
          section.appendChild(title);

          logs[date]
            .slice()
            .sort((a, b) => convertToMinutes(b.time) - convertToMinutes(a.time))
            .forEach((item) => {
              const entry = document.createElement("div");
              entry.className = "border-b last:border-0 pb-2 flex flex-col";

              if (editing.date === date && editing.id === item.id) {
                entry.classList.add("editing", "bg-blue-100");
                if (isNewEdit) entry.classList.add("animate-open");

                const timeInput = document.createElement("input");
                timeInput.type = "time";
                timeInput.value = convertTo24hFormat(item.time);
                timeInput.className = "border rounded p-1 mb-2";
                entry.appendChild(timeInput);

                let endTimeInput = null;
                if (editing.showEndTime) {
                  endTimeInput = document.createElement("input");
                  endTimeInput.type = "time";
                  endTimeInput.value = item.endTime
                    ? convertTo24hFormat(item.endTime)
                    : timeInput.value;
                  endTimeInput.className = "border rounded p-1 mb-2";
                  entry.appendChild(endTimeInput);
                }

                const endToggle = document.createElement("button");
                endToggle.type = "button";
                endToggle.textContent = editing.showEndTime
                  ? "Remove End Time"
                  : "Add End Time";
                endToggle.className =
                  "text-blue-700 text-sm underline mb-2 text-left";
                endToggle.onclick = () => {
                  editing.showEndTime = !editing.showEndTime;
                  renderLogs();
                };
                entry.appendChild(endToggle);

                const activitySelect = document.createElement("select");
                activitySelect.className = "border rounded p-1 mb-2";
                activities.forEach((act) => {
                  const opt = document.createElement("option");
                  opt.value = `${act.emoji} ${act.label}`;
                  opt.textContent = opt.value;
                  if (item.activity === opt.value) opt.selected = true;
                  activitySelect.appendChild(opt);
                });
                entry.appendChild(activitySelect);

                const noteBtn = document.createElement("button");
                noteBtn.type = "button";
                noteBtn.textContent = item.note ? "Edit Note" : "Add Note";
                noteBtn.className =
                  "text-blue-700 text-sm underline mb-2 text-left";
                noteBtn.onclick = () => {
                  showNoteInput = true;
                  renderLogs();
                };
                entry.appendChild(noteBtn);

                const noteInput = document.createElement("textarea");
                noteInput.className = `border rounded p-1 mb-2 w-full ${
                  showNoteInput ? "" : "hidden"
                }`;
                noteInput.placeholder = "Enter note...";
                noteInput.value = item.note || "";
                entry.appendChild(noteInput);

                const btnRow = document.createElement("div");
                btnRow.className = "flex space-x-2";
                const saveBtn = document.createElement("button");
                saveBtn.type = "button";
                saveBtn.textContent = "Save";
                saveBtn.className = "text-green-800 underline";
                saveBtn.onclick = () =>
                  saveEdit(
                    date,
                    item.id,
                    timeInput.value,
                    activitySelect.value,
                    noteInput.value,
                    endTimeInput ? endTimeInput.value : ""
                  );
                const cancelBtn = document.createElement("button");
                cancelBtn.type = "button";
                cancelBtn.textContent = "Cancel";
                cancelBtn.className = "text-gray-800 underline";
                cancelBtn.onclick = cancelEdit;
                const deleteBtn = document.createElement("button");
                deleteBtn.type = "button";
                deleteBtn.textContent = "Delete";
                deleteBtn.className = "text-red-700 underline";
                deleteBtn.onclick = () => deleteEntry(date, item.id);
                btnRow.append(saveBtn, cancelBtn, deleteBtn);
                entry.appendChild(btnRow);
              } else {
                const mainDiv = document.createElement("div");
                mainDiv.className = "flex justify-between items-center";
                const leftDiv = document.createElement("div");
                leftDiv.className = "flex flex-col";
                const timeText = item.endTime
                  ? `${item.time} - ${item.endTime}`
                  : item.time;
                let noteSpan = "";
                if (item.note) {
                  const d =
                    item.note.length > 50
                      ? item.note.slice(0, 50) + "..."
                      : item.note;
                  noteSpan = `<span class="ml-1 italic text-gray-500 truncate-note" title="${item.note}">"${d}"</span>`;
                }
                leftDiv.innerHTML = `<span class="font-semibold">${timeText}</span><div class="flex flex-wrap items-center"><span>${item.activity}</span>${noteSpan}</div>`;
                const editBtn = document.createElement("button");
                editBtn.type = "button";
                editBtn.className = "text-blue-700 hover:text-blue-800";
                editBtn.innerText = "‚úèÔ∏è";
                editBtn.onclick = () => {
                  editing = { date, id: item.id, showEndTime: !!item.endTime };
                  showNoteInput = false;
                  renderLogs();
                };
                mainDiv.append(leftDiv, editBtn);
                entry.appendChild(mainDiv);
              }
              section.appendChild(entry);
            });

          dateItem.appendChild(section);
          logList.appendChild(dateItem);
          if (idx < dates.length - 1) {
            const nav = document.createElement("div");
            nav.className = "flex space-x-2 mt-2";
            nav.innerHTML = `
            <section aria-label="jump-controls-${idx}" class="jump-controls">
            <button onclick="scrollToTop()"     class="px-2 py-1 text-xs rounded border">‚Üë Top</button>
            <button onclick="scrollToBottom()"  class="px-2 py-1 text-xs rounded border">‚Üì Bottom</button>
            </section>
            `;
            section.after(nav);
          }
          lastEditing = { date: editing.date, id: editing.id };
        });
        updateWelcomeMessage();
        updateJumpControlsVisibility();
        updateClearButtonVisibility();
      }

      function saveEdit(date, id, newTime24, newActivity, newNote, newEnd24) {
        const logs = JSON.parse(localStorage.getItem("puppyLogs")) || {};
        const items = logs[date] || [];
        const item = items.find((e) => e.id === id);
        if (item) {
          item.time = convertTo12hFormat(newTime24);
          item.activity = newActivity;
          item.note = newNote.trim() || undefined;
          if (newEnd24) item.endTime = convertTo12hFormat(newEnd24);
          else delete item.endTime;
        }
        logs[date] = items.sort(
          (a, b) => convertToMinutes(a.time) - convertToMinutes(b.time)
        );
        localStorage.setItem("puppyLogs", JSON.stringify(logs));
        editing = { date: null, id: null, showEndTime: false };
        showNoteInput = false;
        renderLogs();
      }

      function cancelEdit() {
        editing = { date: null, id: null, showEndTime: false };
        showNoteInput = false;
        renderLogs();
      }

      function deleteEntry(date, id) {
        const logs = JSON.parse(localStorage.getItem("puppyLogs")) || {};
        logs[date] = (logs[date] || []).filter((e) => e.id !== id);
        if (!logs[date].length) delete logs[date];
        localStorage.setItem("puppyLogs", JSON.stringify(logs));
        cancelEdit();
      }

      function openClearConfirm() {
        document
          .getElementById("clearConfirmModal")
          .classList.replace("hidden", "flex");
      }

      function closeClearConfirm() {
        document
          .getElementById("clearConfirmModal")
          .classList.replace("flex", "hidden");
      }

      function confirmClearLog() {
        localStorage.removeItem("puppyLogs");
        cancelEdit();
        closeClearConfirm();
        renderLogs();
        updateJumpControlsVisibility();
      }

      function openModal() {
        document.getElementById("modal").classList.replace("hidden", "flex");
      }

      function closeModal() {
        document.getElementById("modal").classList.replace("flex", "hidden");
      }

      function convertTo24hFormat(time12h) {
        const [time, modifier] = time12h.split(" ");
        let [hours, minutes] = time.split(":").map(Number);
        if (modifier === "PM" && hours !== 12) hours += 12;
        if (modifier === "AM" && hours === 12) hours = 0;
        return `${String(hours).padStart(2, "0")}:${String(minutes).padStart(
          2,
          "0"
        )}`;
      }

      function convertTo12hFormat(time24h) {
        let [hours, minutes] = time24h.split(":").map(Number);
        const modifier = hours >= 12 ? "PM" : "AM";
        if (hours === 0) hours = 12;
        else if (hours > 12) hours -= 12;
        return `${hours}:${String(minutes).padStart(2, "0")} ${modifier}`;
      }

      function convertToMinutes(timeString) {
        const [time, modifier] = timeString.split(" ");
        let [hours, minutes] = time.split(":").map(Number);
        if (modifier === "PM" && hours !== 12) hours += 12;
        if (modifier === "AM" && hours === 12) hours = 0;
        return hours * 60 + minutes;
      }

      function formatDate(isoDate) {
        const [year, month, day] = isoDate.split("-").map(Number);
        const months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        return `${months[month - 1]} ${day}, ${year}`;
      }

      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function scrollToBottom() {
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });
      }

      function updateJumpControlsVisibility() {
        const logs = JSON.parse(localStorage.getItem("puppyLogs")) || {};
        const hasLogs = Object.keys(logs).length > 0;
        const scrollable =
          document.documentElement.scrollHeight > window.innerHeight;
        const shouldShow = hasLogs && scrollable;

        document.querySelectorAll(".jump-controls").forEach((el) => {
          el.style.display = shouldShow ? "flex" : "none";
        });
      }

      function updateClearButtonVisibility() {
        const logsExist =
          Object.keys(JSON.parse(localStorage.getItem("puppyLogs")) || {})
            .length > 0;
        const btn = document.querySelector(
          'button[onclick="openClearConfirm()"]'
        );
        if (btn) {
          btn.style.display = logsExist ? "inline-block" : "none";
        }
      }

      window.addEventListener("load", updateJumpControlsVisibility);
      window.addEventListener("resize", updateJumpControlsVisibility);
      window.addEventListener("load", updateJumpControlsVisibility);
      window.addEventListener("resize", updateJumpControlsVisibility);

      function openDatePicker() {
        const picker = document.getElementById("datePicker");
        picker.classList.remove("hidden");
        picker.focus();
      }

      document.getElementById("datePicker").addEventListener("change", (e) => {
        const date = e.target.value; // "YYYY-MM-DD"
        e.target.classList.add("hidden");

        // find the exact day's section
        const section = document.querySelector(`section[data-date="${date}"]`);
        if (section) {
          section.scrollIntoView({ behavior: "smooth", block: "start" });
        } else {
          alert(`No entries for ${date}`);
        }

        // reset for next time
        e.target.value = "";
      });

      function updateWelcomeMessage() {
        const logs = JSON.parse(localStorage.getItem("puppyLogs")) || {};
        const welcome = document.getElementById("welcome-message");
        if (Object.keys(logs).length === 0) {
          welcome.classList.remove("hidden");
        } else {
          welcome.classList.add("hidden");
        }
      }

      // Initial render
      renderLogs();
    </script>
  </body>
</html>
