<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-adsense-account" content="ca-pub-5275935514649197">
  <title>Puppy Logger</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .editing {
      background-color: #fef9c3;
    }
    .modal {
      background-color: rgba(0, 0, 0, 0.5);
    }
    .truncate-note {
      max-width: 100%;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

  <h1 class="text-2xl font-bold mb-6">üê∂ Puppy Activity Logger</h1>

  <div class="grid grid-cols-2 gap-4 mb-6 w-full max-w-sm">
    <button onclick="logActivity('üç¥ Feed')" class="bg-blue-400 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded">üç¥ Feed</button>
    <button onclick="logActivity('üõè Nap')" class="bg-purple-400 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded">üõè Nap</button>
    <button onclick="logActivity('‚öΩ Play')" class="bg-green-400 hover:bg-green-500 text-white font-bold py-2 px-4 rounded">‚öΩ Play</button>
    <button onclick="logActivity('üíß Pee')" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-2 px-4 rounded">üíß Pee</button>
    <button onclick="logActivity('üí© Poop')" class="bg-pink-400 hover:bg-pink-500 text-white font-bold py-2 px-4 rounded col-span-2">üí© Poop</button>
  </div>

  <div class="w-full max-w-md space-y-6">
    <div id="logList"></div>
    <button onclick="openClearConfirm()" class="text-sm text-red-500 hover:underline">Clear All Entries</button>
  </div>

  <div class="mt-8 text-xs text-gray-500">
    <a href="#" onclick="openModal()" class="underline">Privacy Policy</a>
  </div>

  <!-- Privacy Policy Modal -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center modal z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 max-w-md">
      <h2 class="text-xl font-bold mb-4">Privacy Policy</h2>
      <p class="mb-4 text-sm">
        This site uses local storage to keep your puppy activity logs private on your own device.
        We do not collect, store, or transmit any personal data to our servers or third parties.
        <br><br>
        If ads are displayed, third-party advertisers may use cookies to serve ads based on your prior visits to this site or other websites.
        <br><br>
        As an Amazon Associate, I earn from qualifying purchases.
      </p>
      <button onclick="closeModal()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">Close</button>
    </div>
  </div>

  <div class="mt-2 text-xs text-gray-500">
    ¬© 2025 Joshua Palmer. All rights reserved.
  </div>  

  <!-- Clear Confirmation Modal -->
  <div id="clearConfirmModal" class="fixed inset-0 hidden items-center justify-center modal z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 max-w-md text-center">
      <h2 class="text-xl font-bold mb-4">Are you sure?</h2>
      <p class="text-sm mb-6">This will delete all your logged puppy activities. This cannot be undone.</p>
      <div class="flex justify-center space-x-4">
        <button onclick="confirmClearLog()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">Yes, Clear</button>
        <button onclick="closeClearConfirm()" class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded">Cancel</button>
      </div>
    </div>
  </div>

<script>
let editing = { date: null, id: null };
let showNoteInput = false;

const activities = [
  { emoji: "üç¥", label: "Feed" },
  { emoji: "üõè", label: "Nap" },
  { emoji: "‚öΩ", label: "Play" },
  { emoji: "üíß", label: "Pee" },
  { emoji: "üí©", label: "Poop" }
];

function logActivity(activity) {
  const now = new Date();
  const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  const today = now.toISOString().split('T')[0];

  const logs = JSON.parse(localStorage.getItem('puppyLogs')) || {};

  if (!logs[today]) {
    logs[today] = [];
  }
  logs[today].unshift({ id: Date.now(), time: timeString, activity });

  localStorage.setItem('puppyLogs', JSON.stringify(logs));
  renderLogs();
}

function renderLogs() {
  const logs = JSON.parse(localStorage.getItem('puppyLogs')) || {};
  const logList = document.getElementById('logList');
  logList.innerHTML = '';

  const dates = Object.keys(logs).sort((a, b) => b.localeCompare(a));

  dates.forEach(date => {
    const section = document.createElement('div');
    section.className = 'bg-white shadow rounded-lg p-4 mb-6';

    const title = document.createElement('h3');
    title.className = 'text-md font-bold mb-2';
    title.textContent = formatDate(date);
    section.appendChild(title);

    logs[date]
  .slice() // defensive copy
  .sort((a, b) => convertToMinutes(b.time) - convertToMinutes(a.time))
  .forEach((item) => {
        const li = document.createElement('div');
        li.className = 'border-b last:border-0 pb-2 flex flex-col';

        if (editing.date === date && editing.id === item.id) {
          li.classList.add('editing');

          const timeInput = document.createElement('input');
          timeInput.type = 'time';
          timeInput.value = convertTo24hFormat(item.time);
          timeInput.className = 'border rounded p-1 mb-2';

          const activitySelect = document.createElement('select');
          activitySelect.className = 'border rounded p-1 mb-2';
          activities.forEach(act => {
            const option = document.createElement('option');
            option.value = `${act.emoji} ${act.label}`;
            option.textContent = `${act.emoji} ${act.label}`;
            if (item.activity === `${act.emoji} ${act.label}`) {
              option.selected = true;
            }
            activitySelect.appendChild(option);
          });

          const noteLink = document.createElement('button');
          noteLink.textContent = item.note ? "Edit Note" : "Add Note";
          noteLink.className = 'text-blue-500 text-sm underline mb-2 text-left';
          noteLink.onclick = () => {
            showNoteInput = true;
            renderLogs();
          };

          const noteInput = document.createElement('textarea');
          noteInput.className = 'border rounded p-1 mb-2 w-full';
          noteInput.placeholder = 'Enter note...';
          noteInput.value = item.note || '';
          if (!showNoteInput) {
            noteInput.classList.add('hidden');
          }

          const buttonRow = document.createElement('div');
          buttonRow.className = 'flex space-x-2';

          const saveBtn = document.createElement('button');
          saveBtn.textContent = 'Save';
          saveBtn.className = 'text-green-600 underline';
          saveBtn.onclick = () => saveEdit(date, item.id, timeInput.value, activitySelect.value, noteInput.value);

          const cancelBtn = document.createElement('button');
          cancelBtn.textContent = 'Cancel';
          cancelBtn.className = 'text-gray-500 underline';
          cancelBtn.onclick = cancelEdit;

          const deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'Delete';
          deleteBtn.className = 'text-red-500 underline';
          deleteBtn.onclick = () => deleteEntry(date, item.id);

          buttonRow.appendChild(saveBtn);
          buttonRow.appendChild(cancelBtn);
          buttonRow.appendChild(deleteBtn);

          li.appendChild(timeInput);
          li.appendChild(activitySelect);
          li.appendChild(noteLink);
          li.appendChild(noteInput);
          li.appendChild(buttonRow);

        } else {
          const mainContent = document.createElement('div');
          mainContent.className = 'flex justify-between items-center';

          const leftContent = document.createElement('div');
          leftContent.className = 'flex flex-col';

          let noteText = '';
          if (item.note) {
            const displayNote = item.note.length > 50 ? item.note.slice(0, 50) + "..." : item.note;
            noteText = `"${displayNote}"`;
          }

          leftContent.innerHTML = `
            <span class="font-semibold">${item.time}</span>
            <div class="flex flex-wrap items-center">
              <span>${item.activity}</span>
              ${noteText ? `<span class="ml-1 italic text-gray-500 truncate-note" title="${item.note}">${noteText}</span>` : ''}
            </div>
          `;

          const editBtn = document.createElement('button');
          editBtn.className = 'text-blue-500 hover:text-blue-700';
          editBtn.innerText = '‚úèÔ∏è';
          editBtn.onclick = () => {
            editing = { date, id: item.id };
            showNoteInput = false;
            renderLogs();
          };

          mainContent.appendChild(leftContent);
          mainContent.appendChild(editBtn);
          li.appendChild(mainContent);
        }

        section.appendChild(li);
      });

    logList.appendChild(section);
  });
}

function saveEdit(date, id, newTime, newActivity, newNote) {
  const logs = JSON.parse(localStorage.getItem('puppyLogs')) || {};
  const items = logs[date];

  const item = items.find(entry => entry.id === id);
  if (item) {
    item.time = convertTo12hFormat(newTime);
    item.activity = newActivity;
    item.note = newNote.trim() || undefined;
  }

  // Sort and overwrite
  logs[date] = items.sort((a, b) => convertToMinutes(a.time) - convertToMinutes(b.time));

  localStorage.setItem('puppyLogs', JSON.stringify(logs));
  
  editing = { date: null, id: null };
  showNoteInput = false;
  renderLogs();
}


function cancelEdit() {
  editing = { date: null, id: null };
  showNoteInput = false;
  renderLogs();
}

function openClearConfirm() {
  document.getElementById('clearConfirmModal').classList.remove('hidden');
  document.getElementById('clearConfirmModal').classList.add('flex');
}

function closeClearConfirm() {
  document.getElementById('clearConfirmModal').classList.remove('flex');
  document.getElementById('clearConfirmModal').classList.add('hidden');
}

function confirmClearLog() {
  localStorage.removeItem('puppyLogs');
  editing = { date: null, id: null };
  showNoteInput = false;
  closeClearConfirm();
  renderLogs();
}

function convertTo24hFormat(time12h) {
  const [time, modifier] = time12h.split(' ');
  let [hours, minutes] = time.split(':');
  if (hours === '12') hours = '00';
  if (modifier === 'PM') hours = parseInt(hours, 10) + 12;
  return `${hours.toString().padStart(2, '0')}:${minutes}`;
}

function convertTo12hFormat(time24h) {
  let [hours, minutes] = time24h.split(':');
  let modifier = 'AM';
  hours = parseInt(hours, 10);
  if (hours >= 12) {
    modifier = 'PM';
    if (hours > 12) hours -= 12;
  } else if (hours === 0) {
    hours = 12;
  }
  return `${hours}:${minutes} ${modifier}`;
}

function formatDate(isoDate) {
  const [year, month, day] = isoDate.split('-');
  const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];
  return `${months[parseInt(month) - 1]} ${parseInt(day)}, ${year}`;
}

function openModal() {
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal').classList.add('flex');
}

function closeModal() {
  document.getElementById('modal').classList.remove('flex');
  document.getElementById('modal').classList.add('hidden');
}

function convertToMinutes(timeString) {
  const [time, modifier] = timeString.split(' ');
  let [hours, minutes] = time.split(':').map(Number);
  if (modifier === 'PM' && hours !== 12) hours += 12;
  if (modifier === 'AM' && hours === 12) hours = 0;
  return hours * 60 + minutes;
}

renderLogs();
</script>

</body>
</html>
