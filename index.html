<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-adsense-account" content="ca-pub-5275935514649197">
  <title>Puppy Logger</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='90'%3Eüê∂%3C/text%3E%3C/svg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .editing {
      background-color: #D0E8FF;
      padding: 0.5rem;
      border-radius: 0.5rem;
      margin-top: 0.4rem;

    }
    .modal {
      background-color: rgba(0, 0, 0, 0.5);
    }
    .truncate-note {
      max-width: 100%;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @keyframes fadeSlideDown {
    from {
      opacity: 0;
      transform: translateY(-4px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-open {
    animation: fadeSlideDown 0.3s cubic-bezier(.6,-0.28,.735,.045);
  }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

  <h1 class="text-2xl font-bold mb-6">üê∂ Puppy Activity Logger</h1>

  <div class="grid grid-cols-2 gap-4 mb-6 w-full max-w-sm">
    <button onclick="logActivity('üç¥ Feed')" class="bg-blue-400 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded">üç¥ Feed</button>
    <button onclick="logActivity('üõè Nap')" class="bg-purple-400 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded">üõè Nap</button>
    <button onclick="logActivity('‚öΩ Play')" class="bg-green-400 hover:bg-green-500 text-white font-bold py-2 px-4 rounded">‚öΩ Play</button>
    <button onclick="logActivity('üíß Pee')" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-2 px-4 rounded">üíß Pee</button>
    <button onclick="logActivity('üí© Poop')" class="bg-pink-400 hover:bg-pink-500 text-white font-bold py-2 px-4 rounded col-span-2">üí© Poop</button>
  </div>

  <div class="w-full max-w-md space-y-6">
    <div id="logList"></div>
    <button onclick="openClearConfirm()" class="text-sm text-red-500 hover:underline">Clear All Entries</button>
  </div>

  <div class="mt-8 text-xs text-gray-500">
    <a href="#" onclick="openModal()" class="underline">Privacy Policy</a>
  </div>

  <!-- Privacy Policy Modal -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center modal z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 max-w-md">
      <h2 class="text-xl font-bold mb-4">Privacy Policy</h2>
      <p class="mb-4 text-sm">
        This site uses local storage to keep your puppy activity logs private on your own device.
        We do not collect, store, or transmit any personal data to our servers or third parties.
        <br><br>
        If ads are displayed, third-party advertisers may use cookies to serve ads based on your prior visits to this site or other websites.
        <br><br>
        As an Amazon Associate, I earn from qualifying purchases.
      </p>
      <button onclick="closeModal()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">Close</button>
    </div>
  </div>

  <div class="mt-2 text-xs text-gray-500">
    ¬© 2025 Joshua Palmer. All rights reserved.
  </div>  

  <!-- Clear Confirmation Modal -->
  <div id="clearConfirmModal" class="fixed inset-0 hidden items-center justify-center modal z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-11/12 max-w-md text-center">
      <h2 class="text-xl font-bold mb-4">Are you sure?</h2>
      <p class="text-sm mb-6">This will delete all your logged puppy activities. This cannot be undone.</p>
      <div class="flex justify-center space-x-4">
        <button onclick="confirmClearLog()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">Yes, Clear</button>
        <button onclick="closeClearConfirm()" class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded">Cancel</button>
      </div>
    </div>
  </div>

<script>
let editing = { date: null, id: null, showEndTime: false };
let showNoteInput = false;

const activities = [
  { emoji: "üç¥", label: "Feed" },
  { emoji: "üõè", label: "Nap" },
  { emoji: "‚öΩ", label: "Play" },
  { emoji: "üíß", label: "Pee" },
  { emoji: "üí©", label: "Poop" }
];

function logActivity(activity) {
  const now = new Date();
  const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  const today = now.toISOString().split('T')[0];
  const logs = JSON.parse(localStorage.getItem('puppyLogs')) || {};
  if (!logs[today]) logs[today] = [];
  logs[today].unshift({ id: Date.now(), time: timeString, activity });
  localStorage.setItem('puppyLogs', JSON.stringify(logs));
  renderLogs();
}

function renderLogs() {
  const logs = JSON.parse(localStorage.getItem('puppyLogs')) || {};
  const logList = document.getElementById('logList');
  logList.innerHTML = '';
  const dates = Object.keys(logs).sort((a, b) => b.localeCompare(a));

  dates.forEach(date => {
    const section = document.createElement('div');
    section.className = 'bg-white shadow rounded-lg p-4 mb-6';
    const title = document.createElement('h3');
    title.className = 'text-md font-bold mb-2';
    title.textContent = formatDate(date);
    section.appendChild(title);

    logs[date]
      .slice()
      .sort((a, b) => convertToMinutes(b.time) - convertToMinutes(a.time))
      .forEach(item => {
        const li = document.createElement('div');
        li.className = 'border-b last:border-0 pb-2 flex flex-col';

        if (editing.date === date && editing.id === item.id) {
          li.classList.add('editing', 'animate-open');


          // Start time picker
          const timeInput = document.createElement('input');
          timeInput.type = 'time';
          timeInput.value = convertTo24hFormat(item.time);
          timeInput.className = 'border rounded p-1 mb-2';
          li.appendChild(timeInput);

          // Optional end-time picker
          let endTimeInput = null;
          if (editing.showEndTime) {
            endTimeInput = document.createElement('input');
            endTimeInput.type = 'time';
            endTimeInput.value = item.endTime
              ? convertTo24hFormat(item.endTime)
              : timeInput.value;
            endTimeInput.className = 'border rounded p-1 mb-2';
            li.appendChild(endTimeInput);
          }

          // Add / Remove End Time toggle
          const endTimeToggle = document.createElement('button');
          endTimeToggle.textContent = editing.showEndTime ? 'Remove End Time' : 'Add End Time';
          endTimeToggle.className = 'text-blue-500 text-sm underline mb-2 text-left';
          endTimeToggle.onclick = () => {
            editing.showEndTime = !editing.showEndTime;
            renderLogs();
          };
          li.appendChild(endTimeToggle);

          // Activity select
          const activitySelect = document.createElement('select');
          activitySelect.className = 'border rounded p-1 mb-2';
          activities.forEach(act => {
            const option = document.createElement('option');
            option.value = `${act.emoji} ${act.label}`;
            option.textContent = `${act.emoji} ${act.label}`;
            if (item.activity === option.value) option.selected = true;
            activitySelect.appendChild(option);
          });
          li.appendChild(activitySelect);

          // Note add/edit
          const noteLink = document.createElement('button');
          noteLink.textContent = item.note ? "Edit Note" : "Add Note";
          noteLink.className = 'text-blue-500 text-sm underline mb-2 text-left';
          noteLink.onclick = () => {
            showNoteInput = true;
            renderLogs();
          };
          li.appendChild(noteLink);

          const noteInput = document.createElement('textarea');
          noteInput.className = showNoteInput
            ? 'border rounded p-1 mb-2 w-full'
            : 'border rounded p-1 mb-2 w-full hidden';
          noteInput.placeholder = 'Enter note...';
          noteInput.value = item.note || '';
          li.appendChild(noteInput);

          // Save / Cancel / Delete buttons
          const buttonRow = document.createElement('div');
          buttonRow.className = 'flex space-x-2';

          const saveBtn = document.createElement('button');
          saveBtn.textContent = 'Save';
          saveBtn.className = 'text-green-600 underline';
          saveBtn.onclick = () => {
            const end24 = endTimeInput ? endTimeInput.value.trim() : '';
            saveEdit(
              date,
              item.id,
              timeInput.value,
              activitySelect.value,
              noteInput.value,
              end24
            );
          };

          const cancelBtn = document.createElement('button');
          cancelBtn.textContent = 'Cancel';
          cancelBtn.className = 'text-gray-500 underline';
          cancelBtn.onclick = cancelEdit;

          const deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'Delete';
          deleteBtn.className = 'text-red-500 underline';
          deleteBtn.onclick = () => deleteEntry(date, item.id);

          buttonRow.appendChild(saveBtn);
          buttonRow.appendChild(cancelBtn);
          buttonRow.appendChild(deleteBtn);
          li.appendChild(buttonRow);

        } else {
          const mainContent = document.createElement('div');
          mainContent.className = 'flex justify-between items-center';

          const leftContent = document.createElement('div');
          leftContent.className = 'flex flex-col';

          const timeDisplay = item.endTime
            ? `${item.time} - ${item.endTime}`
            : item.time;

          let noteText = '';
          if (item.note) {
            const displayNote = item.note.length > 50
              ? item.note.slice(0, 50) + "..."
              : item.note;
            noteText = `<span class="ml-1 italic text-gray-500 truncate-note" title="${item.note}">"${displayNote}"</span>`;
          }

          leftContent.innerHTML = `
            <span class="font-semibold">${timeDisplay}</span>
            <div class="flex flex-wrap items-center">
              <span>${item.activity}</span>
              ${noteText}
            </div>
          `;

          const editBtn = document.createElement('button');
          editBtn.className = 'text-blue-500 hover:text-blue-700';
          editBtn.innerText = '‚úèÔ∏è';
          editBtn.onclick = () => {
            editing = {
              date,
              id: item.id,
              showEndTime: !!item.endTime
            };
            showNoteInput = false;
            renderLogs();
          };

          mainContent.appendChild(leftContent);
          mainContent.appendChild(editBtn);
          li.appendChild(mainContent);
        }

        section.appendChild(li);
      });

    logList.appendChild(section);
  });
}

function saveEdit(date, id, newTime24, newActivity, newNote, newEnd24) {
  const logs = JSON.parse(localStorage.getItem('puppyLogs')) || {};
  const items = logs[date] || [];
  const item = items.find(entry => entry.id === id);
  if (item) {
    item.time = convertTo12hFormat(newTime24);
    item.activity = newActivity;
    item.note = newNote.trim() || undefined;
    if (newEnd24) {
      item.endTime = convertTo12hFormat(newEnd24);
    } else {
      delete item.endTime;
    }
  }
  logs[date] = items.sort((a, b) => convertToMinutes(a.time) - convertToMinutes(b.time));
  localStorage.setItem('puppyLogs', JSON.stringify(logs));
  editing = { date: null, id: null, showEndTime: false };
  showNoteInput = false;
  renderLogs();
}

function cancelEdit() {
  editing = { date: null, id: null, showEndTime: false };
  showNoteInput = false;
  renderLogs();
}

function deleteEntry(date, id) {
  const logs = JSON.parse(localStorage.getItem('puppyLogs')) || {};
  logs[date] = (logs[date] || []).filter(e => e.id !== id);
  if (logs[date].length === 0) delete logs[date];
  localStorage.setItem('puppyLogs', JSON.stringify(logs));
  cancelEdit();
}

function openClearConfirm() {
  document.getElementById('clearConfirmModal').classList.remove('hidden');
  document.getElementById('clearConfirmModal').classList.add('flex');
}

function closeClearConfirm() {
  document.getElementById('clearConfirmModal').classList.remove('flex');
  document.getElementById('clearConfirmModal').classList.add('hidden');
}

function confirmClearLog() {
  localStorage.removeItem('puppyLogs');
  editing = { date: null, id: null, showEndTime: false };
  showNoteInput = false;
  closeClearConfirm();
  renderLogs();
}

function convertTo24hFormat(time12h) {
  const [time, modifier] = time12h.split(' ');
  let [hourStr, minuteStr] = time.split(':');
  let hours = parseInt(hourStr, 10);
  const minutes = parseInt(minuteStr, 10);

  // handle midnight/noon
  if (modifier === 'PM' && hours !== 12) hours += 12;
  if (modifier === 'AM' && hours === 12) hours = 0;

  const hh = String(hours).padStart(2, '0');
  const mm = String(minutes).padStart(2, '0');
  return `${hh}:${mm}`;
}


function convertTo12hFormat(time24h) {
  let [hours, minutes] = time24h.split(':');
  hours = parseInt(hours, 10);
  const modifier = hours >= 12 ? 'PM' : 'AM';
  if (hours === 0) hours = 12;
  else if (hours > 12) hours -= 12;
  return `${hours}:${minutes} ${modifier}`;
}

function convertToMinutes(timeString) {
  const [time, modifier] = timeString.split(' ');
  let [hours, minutes] = time.split(':').map(Number);
  if (modifier === 'PM' && hours !== 12) hours += 12;
  if (modifier === 'AM' && hours === 12) hours = 0;
  return hours * 60 + minutes;
}

function formatDate(isoDate) {
  const [year, month, day] = isoDate.split('-');
  const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];
  return `${months[parseInt(month, 10) - 1]} ${parseInt(day, 10)}, ${year}`;
}

function openModal() {
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal').classList.add('flex');
}

function closeModal() {
  document.getElementById('modal').classList.remove('flex');
  document.getElementById('modal').classList.add('hidden');
}

renderLogs();
</script>

</body>
</html>
