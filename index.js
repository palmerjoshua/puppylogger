let editing={date:null,id:null,showEndTime:!1},lastEditing={date:null,id:null},showNoteInput=!1;const activities=[{emoji:"🍴",label:"Feed"},{emoji:"🛏",label:"Nap"},{emoji:"⚽",label:"Play"},{emoji:"💧",label:"Pee"},{emoji:"💩",label:"Poop"}];function logActivity(e){const t=new Date,n=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),o=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,i=JSON.parse(localStorage.getItem("puppyLogs"))||{};i[o]||(i[o]=[]),i[o].unshift({id:Date.now(),time:n,activity:e}),localStorage.setItem("puppyLogs",JSON.stringify(i)),renderLogs()}function renderLogs(){const e=editing.date!==lastEditing.date||editing.id!==lastEditing.id,t=JSON.parse(localStorage.getItem("puppyLogs"))||{},n=document.getElementById("logList");n.innerHTML="";const o=Object.keys(t).sort(((e,t)=>t.localeCompare(e)));o.forEach(((i,l)=>{const a=document.createElement("li"),d=document.createElement("section");d.className="bg-white shadow rounded-lg p-4",d.setAttribute("data-date",i),d.id=`section-${i}`;const c=document.createElement("h3");if(c.className="text-md font-bold mb-2",c.textContent=formatDate(i),d.appendChild(c),t[i].slice().sort(((e,t)=>convertToMinutes(t.time)-convertToMinutes(e.time))).forEach((t=>{const n=document.createElement("div");if(n.className="border-b last:border-0 pb-2 flex flex-col",editing.date===i&&editing.id===t.id){n.classList.add("editing","bg-blue-100"),e&&n.classList.add("animate-open");const o=document.createElement("input");o.type="time",o.value=convertTo24hFormat(t.time),o.className="border rounded p-1 mb-2",o.setAttribute("data-ga-event","entry_start_time_edit"),n.appendChild(o);let l=null;editing.showEndTime&&(l=document.createElement("input"),l.type="time",l.value=t.endTime?convertTo24hFormat(t.endTime):o.value,l.className="border rounded p-1 mb-2",l.setAttribute("data-ga-event","entry_end_time_edit"),n.appendChild(l));const a=document.createElement("button");a.type="button",a.textContent=editing.showEndTime?"Remove End Time":"Add End Time",a.className="text-blue-700 text-sm underline mb-2 text-left",a.setAttribute("data-ga-event",editing.showEndTime?"entry_end_time_remove_click":"entry_end_time_add_click"),a.onclick=()=>{editing.showEndTime=!editing.showEndTime,renderLogs()},n.appendChild(a);const d=document.createElement("select");d.className="border rounded p-1 mb-2",activities.forEach((e=>{const n=document.createElement("option");n.value=`${e.emoji} ${e.label}`,n.textContent=n.value,t.activity===n.value&&(n.selected=!0),d.appendChild(n)})),d.setAttribute("data-ga-event","entry_activity_edit_click"),n.appendChild(d);const c=document.createElement("button");c.type="button",c.textContent=t.note?"Edit Note":"Add Note",c.className="text-blue-700 text-sm underline mb-2 text-left",c.setAttribute("data-ga-event",t.note?"entry_note_edit_click":"entry_note_add_click"),c.onclick=()=>{showNoteInput=!0,renderLogs()},n.appendChild(c);const s=document.createElement("textarea");s.className="border rounded p-1 mb-2 w-full "+(showNoteInput?"":"hidden"),s.placeholder="Enter note...",s.value=t.note||"",n.appendChild(s);const r=document.createElement("div");r.className="flex space-x-2";const m=document.createElement("button");m.type="button",m.textContent="Save",m.className="text-green-800 underline",m.onclick=()=>saveEdit(i,t.id,o.value,d.value,s.value,l?l.value:""),m.setAttribute("data-ga-event","entry_edit_save_click");const u=document.createElement("button");u.type="button",u.textContent="Cancel",u.className="text-gray-800 underline",u.onclick=cancelEdit,u.setAttribute("data-ga-event","entry_edit_cancel_click");const p=document.createElement("button");p.type="button",p.textContent="Delete",p.className="text-red-700 underline",p.onclick=()=>deleteEntry(i,t.id),p.setAttribute("data-ga-event","entry_edit_delete_click"),r.append(m,u,p),n.appendChild(r)}else{const e=document.createElement("div");e.className="flex justify-between items-center";const o=document.createElement("div");o.className="flex flex-col";const l=t.endTime?`${t.time} - ${t.endTime}`:t.time;let a="";if(t.note){const e=t.note.length>50?t.note.slice(0,50)+"...":t.note;a=`<span class="ml-1 italic text-gray-500 truncate-note" title="${t.note}">"${e}"</span>`}o.innerHTML=`<span class="font-semibold">${l}</span><div class="flex flex-wrap items-center"><span>${t.activity}</span>${a}</div>`;const d=document.createElement("button");d.type="button",d.className="text-blue-700 hover:text-blue-800",d.innerText="✏️",d.setAttribute("data-ga-event","entry_edit_click"),d.onclick=()=>{editing={date:i,id:t.id,showEndTime:!!t.endTime},showNoteInput=!1,renderLogs()},e.append(o,d),n.appendChild(e)}d.appendChild(n)})),a.appendChild(d),n.appendChild(a),l<o.length-1){const e=document.createElement("div");e.className="flex space-x-2 mt-2",e.innerHTML=`\n      <section aria-label="jump-controls-${l}" class="jump-controls">\n      <button onclick="scrollToTop()" class="px-2 py-1 text-xs rounded border" data-ga-event="middle_scroll_top">↑ Top</button>\n      <button onclick="scrollToBottom()" class="px-2 py-1 text-xs rounded border" data-ga-event="middle_scroll_bottom">↓ Bottom</button>\n      </section>\n      `,d.after(e)}lastEditing={date:editing.date,id:editing.id}})),updateWelcomeMessage(),updateJumpControlsVisibility(),updateClearButtonVisibility()}function saveEdit(e,t,n,o,i,l){const a=JSON.parse(localStorage.getItem("puppyLogs"))||{},d=a[e]||[],c=d.find((e=>e.id===t));c&&(c.time=convertTo12hFormat(n),c.activity=o,c.note=i.trim()||void 0,l?c.endTime=convertTo12hFormat(l):delete c.endTime),a[e]=d.sort(((e,t)=>convertToMinutes(e.time)-convertToMinutes(t.time))),localStorage.setItem("puppyLogs",JSON.stringify(a)),editing={date:null,id:null,showEndTime:!1},showNoteInput=!1,renderLogs()}function cancelEdit(){editing={date:null,id:null,showEndTime:!1},showNoteInput=!1,renderLogs()}function deleteEntry(e,t){const n=JSON.parse(localStorage.getItem("puppyLogs"))||{};n[e]=(n[e]||[]).filter((e=>e.id!==t)),n[e].length||delete n[e],localStorage.setItem("puppyLogs",JSON.stringify(n)),cancelEdit()}function openClearConfirm(){document.getElementById("clearConfirmModal").classList.replace("hidden","flex")}function closeClearConfirm(){document.getElementById("clearConfirmModal").classList.replace("flex","hidden")}function confirmClearLog(){localStorage.removeItem("puppyLogs"),cancelEdit(),closeClearConfirm(),renderLogs(),updateJumpControlsVisibility()}function openModal(){document.getElementById("modal").classList.replace("hidden","flex")}function closeModal(){document.getElementById("modal").classList.replace("flex","hidden")}function convertTo24hFormat(e){const[t,n]=e.split(" ");let[o,i]=t.split(":").map(Number);return"PM"===n&&12!==o&&(o+=12),"AM"===n&&12===o&&(o=0),`${String(o).padStart(2,"0")}:${String(i).padStart(2,"0")}`}function convertTo12hFormat(e){let[t,n]=e.split(":").map(Number);const o=t>=12?"PM":"AM";return 0===t?t=12:t>12&&(t-=12),`${t}:${String(n).padStart(2,"0")} ${o}`}function convertToMinutes(e){const[t,n]=e.split(" ");let[o,i]=t.split(":").map(Number);return"PM"===n&&12!==o&&(o+=12),"AM"===n&&12===o&&(o=0),60*o+i}function formatDate(e){const[t,n,o]=e.split("-").map(Number);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][n-1]} ${o}, ${t}`}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function scrollToBottom(){window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}function updateJumpControlsVisibility(){const e=JSON.parse(localStorage.getItem("puppyLogs"))||{},t=Object.keys(e).length>0,n=document.documentElement.scrollHeight>window.innerHeight,o=t&&n;document.querySelectorAll(".jump-controls").forEach((e=>{e.style.display=o?"flex":"none"}))}function updateClearButtonVisibility(){const e=Object.keys(JSON.parse(localStorage.getItem("puppyLogs"))||{}).length>0,t=document.querySelector('button[onclick="openClearConfirm()"]');t&&(t.style.display=e?"inline-block":"none")}function openDatePicker(){const e=document.getElementById("datePicker");e.classList.remove("hidden"),e.focus()}function updateWelcomeMessage(){const e=JSON.parse(localStorage.getItem("puppyLogs"))||{},t=document.getElementById("welcome-message");0===Object.keys(e).length?t.classList.remove("hidden"):t.classList.add("hidden")}window.addEventListener("load",updateJumpControlsVisibility),window.addEventListener("resize",updateJumpControlsVisibility),window.addEventListener("load",updateJumpControlsVisibility),window.addEventListener("resize",updateJumpControlsVisibility),document.getElementById("datePicker").addEventListener("change",(e=>{const t=e.target.value;e.target.classList.add("hidden");const n=document.querySelector(`section[data-date="${t}"]`);n?n.scrollIntoView({behavior:"smooth",block:"start"}):alert(`No entries for ${t}`),e.target.value=""}));